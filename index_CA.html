<!-- Content Header (Page header) -->
<div class="content-header">
    <div class="container-fluid">
    <div class="row mb-2">
        <div class="col-sm-6">
        <h1 class="m-0" id="business_name">[Loading..]</h1>
        </div><!-- /.col -->
        <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="#">Home</a></li>
            <li class="breadcrumb-item active">Dashboard</li>
        </ol>
        </div><!-- /.col -->
    </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->

<!-- Main content -->
<section class="content">
    <div class="container-fluid">
    <!-- Small boxes (Stat box) -->
    <div class="row">
        <div class="col-lg-3 col-6">
        <!-- small box -->
        <div class="small-box bg-info">
            <div class="inner">
            <h3>Loading..</h3>

            <p>Worker On Site</p>
            </div>
            <div class="icon">
            <i class="ion ion-clipboard"></i>
            </div>
            <!-- <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a> -->
        </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-6">
        <!-- small box -->
        <div class="small-box bg-success">
            <div class="inner">
            <h3>Loading..</h3>

            <p>Not On Site</p>
            </div>
            <div class="icon">
            <i class="ion ion-stats-bars"></i>
            </div>
            <!-- <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a> -->
        </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-6">
        <!-- small box -->
        <div class="small-box bg-warning">
            <div class="inner">
            <h3>Loading..</h3>

            <p>Total Workers</p>
            </div>
            <div class="icon">
            <i class="ion ion-person-add"></i>
            </div>
            <!-- <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a> -->
        </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-6">
        <!-- small box -->
        <div class="small-box bg-danger">
            <div class="inner">
            <h3>Loading..</h3>

            <p>Visitors</p>
            </div>
            <div class="icon">
            <i class="ion ion-pie-graph"></i>
            </div>
            <!-- <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a> -->
        </div>
        </div>
        <!-- ./col -->
    </div>
    <!-- /.row -->
    <!-- Main row -->
    <div class="row">
        <div class="col-12">
        <div class="card">
            <div class="card-header">
            <h3 class="card-title">Logs</h3>
            <div class="card-tools">
                <div class="input-group input-group-sm" style="width: 150px;">
                <input type="text" name="table_search" class="form-control float-right" placeholder="Search" disabled>
                <div class="input-group-append">
                    <button type="submit" class="btn btn-default" disabled>
                    <i class="fas fa-search"></i>
                    </button>
                </div>
                </div>
            </div>
            </div>
            <!-- /.card-header -->
            <div class="card-body table-responsive p-0" style="height: 300px;" id="ListAccesses">
            <table class="table table-head-fixed text-nowrap">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Date</th>
                    <th>Area</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            </div>
            <!-- /.card-body -->
        </div>
        </div>  
    </div>
    <div class="row mb-2">
        <div class="col-sm-10">
        <h4>Add/Edit/View Users</h4>
        </div>
        <div class="col-sm-2 mb-2">
        <a href="addprofile.html">
        <button type="button" class="btn btn-success btn-block"><i class="ion ion-person-add"></i> Add User</button>
        </a>
        </div>
        <!-- <div class="col-sm-2">
            <div class="input-group input-group">
            <input type="text" name="table_search" class="form-control float-right" placeholder="Search" disabled>

            <div class="input-group-append">
                <button type="submit" class="btn btn-default" disabled>
                <i class="fas fa-search"></i>
                </button>
            </div>
            </div>
        </div> -->
    </div>
    <div class="row">
        <div class="col-12">
        <div class="card card-solid">
            <div class="card-body pb-0">
            <div class="row" id="show_workers">
                
            </div>
            </div>
            <!-- /.card-body -->
            <div class="card-footer">
            <nav aria-label="Contacts Page Navigation">
                <ul class="pagination justify-content-center m-0" id="workes_page_navigation">
                </ul>
            </nav>
            </div>
            <!-- /.card-footer -->
        </div>
        </div>
    </div>
    <!-- /.row (main row) -->
    </div><!-- /.container-fluid -->
</section>
<!-- /.content -->

<script>
    $(document).ready(function(){

        $.post("get_info.php", 
        { 
            info_id: "5",
            role: "CA"
        },
        
        function(data, status, xhr) {
            if (xhr.status == 200) {
            
            } else {
                alert("You do not have the permission to see this page.");
            }
        });

        var userReceived = [];

        function showWorkers(obj) {
            $.each( obj.data, function( key, value ) {
                data = obj.data[key];
                data_len = obj.data.length;
                data_grid = "col-12 col-sm-6 col-md-4";
                if (data_len == 1) {
                data_grid = "col-12 col-sm-12 col-md-12";
                }
                if (data_len == 2) {
                data_grid = "col-12 col-sm-6 col-md-6";
                }

                userReceived.push(data);

                $("#show_workers").append
                (
                '<div class="'+data_grid+' d-flex align-items-stretch flex-column"> \
                    <div class="card bg-light d-flex flex-fill"> \
                    <div class="card-header text-muted border-bottom-0"> \
                        '+data["name"]+' '+data["surname"]+' \
                    </div> \
                    <div class="card-body pt-0"> \
                        <div class="row"> \
                        <div class="col-7"> \
                            <h2 class="lead"><b>'+data["username"]+'</b></h2> \
                            <p class="text-muted text-sm"><b>Role: </b>'+expandRole(data["role"])+'</p> \
                            <ul class="ml-4 mb-0 fa-ul text-muted"> \
                            <li class="small"><span class="fa-li"><i class="fas fa-lg fa-building"></i></span> Address: Function not implemented</li> \
                            <li class="small"><span class="fa-li"><i class="fas fa-lg fa-phone"></i></span> Phone #: Function not implemented</li> \
                            </ul> \
                        </div> \
                        <div class="col-5 text-center"> \
                            <img src="../../dist/img/user1-128x128.jpg" alt="user-avatar" class="img-circle img-fluid"> \
                        </div> \
                        </div> \
                    </div> \
                    <div class="card-footer"> \
                        <div class="text-right"> \
                        <a href="editprofile.html?id='+data["id"]+'" class="btn btn-sm btn-danger"> \
                            <i class="fas fa-user-edit"></i> Edit Profile \
                        </a> \
                        <a href="viewprofile.html?id='+data["id"]+'" class="btn btn-sm btn-primary"> \
                            <i class="fas fa-user"></i> View Profile \
                        </a> \
                        </div> \
                    </div> \
                    </div> \
                </div>'
                );
            });
        }

        $.post("get_info.php", 
        { 
            info_id: 1,
            page: 1
        },
        
        function(data, status, xhr) {
            if (xhr.status == 200) {
                obj = JSON.parse(data);
                if (obj.amount > 9) {
                    var iteration = obj.amount/9;
                    for(let i = 1; i < 1 + iteration; i++) {
                    $("#workes_page_navigation").append
                    ('<li class="page-item" id="page_number" number="'+i+'"><a class="page-link">'+i+'</a></li>');
                    }
                    $("#page_number[number=1]").addClass("active");
                }
                if (obj.data) {
                    showWorkers(obj);
                } else {
                    alert("No workes found..");
                }
            } else responseByID(obj.response);
        });

        $.post("get_info.php", 
        { 
            info_id: "0",
        },
        
        function(data, status, xhr) {
            if (xhr.status == 200) {
                obj = JSON.parse(data);
                
                if (obj.data) {
                    $.each( obj.data, function( key, value ) {
                    data = obj.data[key];
                    $("#ListAccesses tbody").append("<tr>"+
                        "<td>"+data["id"]+"</td>"+
                        "<td>"+data["PersonID"]+"</td>"+
                        "<td>"+data["Time"]+"</td>"+
                        "<td>"+data["Area"]+"</td>"+
                        "<td>"+data["action"]+"</td>"+
                        "</tr>");
                    });
                }
            } else responseByID(obj.response);     
        });

        $.post("get_info.php", 
        { 
            info_id: "4",
        },
        
        function(data, status, xhr) {
            obj = JSON.parse(data);
            if (xhr.status == 200) {
                if (obj.business_name) {
                    $("#business_name").text("["+obj.business_name+"] Dashboard - Customer Administrator")
                }
            } else responseByID(obj.response);
        });

        $(document).on('click', "#page_number", function(){
            var pageNumber = $(this).attr('number');
            $("#show_workers").empty();
            $("#workes_page_navigation").empty();
        
            $.post("get_info.php", 
            { 
                info_id: 1,
                page: pageNumber
            },
            
            function(data, status, xhr) {
                obj = JSON.parse(data);
                if (xhr.status == 200) {
                    if (obj.amount > 9) {
                        var iteration = obj.amount/9;
                        for(let i = 1; i < 1 + iteration; i++) {
                            if (i == pageNumber)
                            $("#workes_page_navigation").append
                            ('<li class="page-item active" id="page_number" number="'+i+'"><a class="page-link">'+i+'</a></li>');
                        
                            else
                            $("#workes_page_navigation").append
                            ('<li class="page-item" id="page_number" number="'+i+'"><a class="page-link">'+i+'</a></li>');
                        }
                    }
                    
                    if (obj.data) {
                        showWorkers(obj);
                    } else {
                        alert("No workes found..");
                    }
                } else responseByID(obj.response);
            });
        });
    });
</script>